class TravelplansController < ApplicationController

  def index
    @travelplans = Travelplan.paginate(page: params[:page])
    @travelplan = Travelplan.new(params[:travelplan])
  end

  def newplan
    @travelplan = Travelplan.new(params[:travelplan])
  end
  
  def create
    @travelplan = Travelplan.new(params[:travelplan])
    if @travelplan.save
      redirect_to @travelplan
    else
      redirect_to root_url
    end
  end

  def show
	@travelplan = Travelplan.find(params[:id])
	@micropost = Micropost.new
	$CURRENT_PLAN = @travelplan
	@planmicropost = Micropost.new
	@traveltrack = Traveltrack.new
	@currentindex = 0
	@feed_items = Micropost.paginate(conditions: ["parent is (?)", $CURRENT_LOCALE], page: params[:page]).order("microposts.created_at DESC")
  end
  
  def readview 
  	  @travelplan = Travelplan.find(params[:id])
  	  render layout: 'readview'
  end

  def createnote
  	  @travelnote = Travelnote.new
  	  @travelnote.locale = $CURRENT_PLAN.locale
  	  @travelnote.notename = $CURRENT_PLAN.planname
  	  @travelnote.save
  	  $CURRENT_PLAN.traveltracks.each do |pt|
  	  	  @notetrack = Notetrack.new
  	  	  @notetrack.note_id = @travelnote.id
  	  	  @notetrack.startpoint = pt.startpoint
  	  	  @notetrack.terminal = pt.terminal
  	  	  @notetrack.save
  	  end
  	  redirect_to @travelnote
  end
  
  def edit
    @travelplan = Travelplan.find(params[:id])
  end

  def update
    @travelplan = Travelplan.find(params[:id])
    if @travelplan.update_attributes(params[:travelplan])
      flash[:success] = "Travelplan updated!"
      redirect_to :back
    else
      render 'edit'
    end
  end
  
  def destroy
    @travelplan = Travelplan.find(params[:id])
	@travelplan.destroy
	redirect_to '/travelplanindex'
  end
  
end